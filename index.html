<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login / Signup | Game Portal</title>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
  <style>
    * {margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif;}
    body {
      display:flex; justify-content:center; align-items:center;
      height:100vh; background:linear-gradient(135deg,#ffc1cc,#ffe6f0);
    }
    .container {
      position:relative; width:350px; height:470px; overflow:hidden;
      border-radius:20px; background:white; box-shadow:0 10px 25px rgba(0,0,0,0.15);
    }
    .forms {position:absolute; width:100%; height:200%; top:0; transition:transform 1s ease;}
    .container.active .forms {transform:translateY(-50%);}
    .form-box {width:100%; height:50%; padding:40px 30px;
      display:flex; flex-direction:column; justify-content:center; align-items:center;}
    .form-box h2 {margin-bottom:20px; color:#ff4d88;}
    .form-box input {
      width:100%; padding:12px; margin:8px 0; border:2px solid #ffc1cc;
      border-radius:12px; outline:none; font-size:14px; transition:0.3s ease;
    }
    .form-box input:focus {border-color:#ff4d88;}
    .form-box button {
      width:100%; padding:12px; margin-top:15px; background:#ff4d88;
      color:white; border:none; border-radius:12px; font-size:16px; cursor:pointer;
      transition:0.3s ease;
    }
    .form-box button:hover {background:#e6005c;}
    .toggle {margin-top:20px; font-size:14px;}
    .toggle a {color:#ff4d88; font-weight:bold; cursor:pointer; text-decoration:none;}
  </style>
</head>
<body>

<div class="container" id="container">
  <div class="forms">
    <!-- Login Form -->
    <div class="form-box login">
      <h2>Login</h2>
      <input type="email" id="loginEmail" placeholder="Email" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button id="loginBtn">Login</button>
      <div class="toggle">Don‚Äôt have an account? <a id="toSignup">Sign Up</a></div>
    </div>

    <!-- Signup Form -->
    <div class="form-box signup">
      <h2>Sign Up</h2>
      <input type="text" id="signupUsername" placeholder="Username" required />
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <button id="signupBtn">Sign Up</button>
      <div class="toggle">Already have an account? <a id="toLogin">Login</a></div>
    </div>
  </div>
</div>

<script>
  // Slide animation between Login & Signup
  const container = document.getElementById("container");
  document.getElementById("toSignup").addEventListener("click", ()=>container.classList.add("active"));
  document.getElementById("toLogin").addEventListener("click", ()=>container.classList.remove("active"));

  // Appwrite Configuration
  const client = new Appwrite.Client()
    .setEndpoint("https://cloud.appwrite.io/v1")
    .setProject("project-fra-69130680003614241257");

  const account = new Appwrite.Account(client);
  const databases = new Appwrite.Databases(client);

  const databaseId = "database-69130a1b0008aa5fa204";
  const usersTableId = "table-users";

  // SIGNUP
  document.getElementById("signupBtn").addEventListener("click", async () => {
    const username = document.getElementById("signupUsername").value.trim();
    const email = document.getElementById("signupEmail").value.trim();
    const password = document.getElementById("signupPassword").value.trim();

    try {
      const res = await account.create('unique()', email, password, username);
      alert("‚úÖ Account created successfully!");
      container.classList.remove("active");

      // Create a user record in your users table
      await databases.createDocument(databaseId, usersTableId, 'unique()', {
        username, email, points: 0
      });
    } catch (err) {
      alert("‚ùå Error: " + err.message);
    }
  });

  // LOGIN
  document.getElementById("loginBtn").addEventListener("click", async () => {
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value.trim();

    try {
      await account.createEmailPasswordSession(email, password);
      const user = await account.get();
      alert(`‚úÖ Welcome back, ${user.name || user.email}!`);

      // Fetch user data (points)
      const res = await databases.listDocuments(databaseId, usersTableId, [
        Appwrite.Query.equal("email", [email])
      ]);
      if (res.documents.length > 0) {
        const data = res.documents[0];
        alert(`You currently have ${data.points} points üéØ`);
      }
    } catch (err) {
      alert("‚ùå Login failed: " + err.message);
    }
  });
</script>

</body>
</html>
